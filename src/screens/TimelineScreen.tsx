import React, { useState, useCallback } from 'react';
import {
  View,
  Text,
  StyleSheet,
  FlatList,
  TouchableOpacity,
  RefreshControl,
  Modal,
  TextInput,
  Alert,
  Image,
  Keyboard,
  TouchableWithoutFeedback,
  Platform,
} from 'react-native';
import { useFocusEffect } from '@react-navigation/native';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { StackNavigationProp } from '@react-navigation/stack';
import Icon from 'react-native-vector-icons/Feather';
import { useTheme } from '../contexts/ThemeContext';
import { DiaryEntry, RootStackParamList } from '../types';
import { loadDiaryEntries, saveDiaryEntry } from '../utils/storage';
import ThemeBackground from '../components/ThemeBackground';
import { WidgetService } from '../services/WidgetService';

type TimelineScreenNavigationProp = StackNavigationProp<
  RootStackParamList,
  'MainTabs'
>;

interface Props {
  navigation: TimelineScreenNavigationProp;
}

interface TimelineItem {
  entry: DiaryEntry;
  status: 'past' | 'today' | 'future';
  daysFromNow: number;
}

const TimelineScreen: React.FC<Props> = ({ navigation }) => {
  const { currentTheme } = useTheme();
  const safeAreaInsets = useSafeAreaInsets();
  const [timelineItems, setTimelineItems] = useState<TimelineItem[]>([]);
  const [todayEntries, setTodayEntries] = useState<DiaryEntry[]>([]);
  const [loading, setLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);
  const [showResultModal, setShowResultModal] = useState(false);
  const [selectedEntry, setSelectedEntry] = useState<DiaryEntry | null>(null);
  const [selectedStatus, setSelectedStatus] = useState<
    'realized' | 'not_realized' | null
  >(null);
  const [actualResultDetail, setActualResultDetail] = useState('');

  // Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ ÏòµÏÖò Ï†ïÎ≥¥ (WriteEntryScreenÍ≥º ÎèôÏùº)
  const categoryOptionsMap = {
    weather: {
      title: 'ÎÇ†Ïî®',
      options: {
        sunny: { name: 'ÎßëÏùå', icon: '‚òÄÔ∏è', color: '#FFE066' },
        cloudy: { name: 'ÌùêÎ¶º', icon: '‚òÅÔ∏è', color: '#E0E0E0' },
        rainy: { name: 'ÎπÑ', icon: 'üåßÔ∏è', color: '#81D4FA' },
        snowy: { name: 'Îàà', icon: '‚ùÑÔ∏è', color: '#E1F5FE' },
        windy: { name: 'Î∞îÎûå', icon: 'üí®', color: '#B0BEC5' },
      } as const,
    },
    people: {
      title: 'ÏÇ¨Îûå',
      options: {
        friends: { name: 'ÏπúÍµ¨', icon: '‚≠ê', color: '#64B5F6' },
        family: { name: 'Í∞ÄÏ°±', icon: 'üå±', color: '#81C784' },
        lover: { name: 'Ïó∞Ïù∏', icon: 'üíñ', color: '#F06292' },
        acquaintance: { name: 'ÏßÄÏù∏', icon: 'üòä', color: '#FFB74D' },
        alone: { name: 'ÎßåÎÇòÏßÄ ÏïäÏùå', icon: '‚ùå', color: '#90A4AE' },
      } as const,
    },
    school: {
      title: 'ÌïôÍµê',
      options: {
        class: { name: 'ÏàòÏóÖ', icon: 'üìö', color: '#4CAF50' },
        study: { name: 'Í≥µÎ∂Ä', icon: 'üîç', color: '#FFC107' },
        assignment: { name: 'Í≥ºÏ†ú', icon: 'üìù', color: '#FF9800' },
        exam: { name: 'ÏãúÌóò', icon: 'üå∏', color: '#E91E63' },
        teamwork: { name: 'ÌåÄÌîå', icon: 'üí¨', color: '#4CAF50' },
      } as const,
    },
    company: {
      title: 'ÌöåÏÇ¨',
      options: {
        meeting: { name: 'ÌöåÏùò', icon: 'üë•', color: '#2196F3' },
        work: { name: 'ÏóÖÎ¨¥', icon: 'üíº', color: '#607D8B' },
        project: { name: 'ÌîÑÎ°úÏ†ùÌä∏', icon: 'üìä', color: '#9C27B0' },
        presentation: { name: 'Î∞úÌëú', icon: 'üé§', color: '#FF5722' },
        training: { name: 'ÍµêÏú°', icon: 'üìñ', color: '#795548' },
      } as const,
    },
    travel: {
      title: 'Ïó¨Ìñâ',
      options: {
        airplane: { name: 'ÎπÑÌñâÍ∏∞', icon: '‚úàÔ∏è', color: '#03A9F4' },
        ship: { name: 'Î∞∞', icon: 'üö¢', color: '#00BCD4' },
        train: { name: 'Í∏∞Ï∞®', icon: 'üöÑ', color: '#4CAF50' },
        bus: { name: 'Î≤ÑÏä§', icon: 'üöå', color: '#FF9800' },
        car: { name: 'ÏäπÏö©Ï∞®', icon: 'üöó', color: '#9E9E9E' },
        motorcycle: { name: 'Ïò§ÌÜ†Î∞îÏù¥', icon: 'üèçÔ∏è', color: '#F44336' },
      } as const,
    },
    food: {
      title: 'ÏùåÏãù',
      options: {
        korean: { name: 'ÌïúÏãù', icon: 'üçö', color: '#8BC34A' },
        western: { name: 'ÏñëÏãù', icon: 'üçù', color: '#FFC107' },
        chinese: { name: 'Ï§ëÏãù', icon: 'ü•¢', color: '#FF5722' },
        japanese: { name: 'ÏùºÏãù', icon: 'üç£', color: '#E91E63' },
        fast_food: { name: 'Ìå®Ïä§Ìä∏Ìë∏Îìú', icon: 'üçî', color: '#FF9800' },
      } as const,
    },
    dessert: {
      title: 'ÎîîÏ†ÄÌä∏',
      options: {
        cake: { name: 'ÏºÄÏù¥ÌÅ¨', icon: 'üç∞', color: '#F8BBD9' },
        ice_cream: { name: 'ÏïÑÏù¥Ïä§ÌÅ¨Î¶º', icon: 'üç¶', color: '#E1F5FE' },
        chocolate: { name: 'Ï¥àÏΩúÎ¶ø', icon: 'üç´', color: '#8D6E63' },
        cookie: { name: 'Ïø†ÌÇ§', icon: 'üç™', color: '#FFCC02' },
        fruit: { name: 'Í≥ºÏùº', icon: 'üçì', color: '#4CAF50' },
      } as const,
    },
    drink: {
      title: 'ÏùåÎ£å',
      options: {
        coffee: { name: 'Ïª§Ìîº', icon: '‚òï', color: '#8D6E63' },
        milk_tea: { name: 'Î∞ÄÌÅ¨Ìã∞', icon: 'üßã', color: '#D7CCC8' },
        juice: { name: 'Ï£ºÏä§', icon: 'üßÉ', color: '#FFC107' },
        water: { name: 'Î¨º', icon: 'üíß', color: '#03A9F4' },
        alcohol: { name: 'Ïà†', icon: 'üç∫', color: '#FF9800' },
      } as const,
    },
  } as const;

  const loadTimeline = async () => {
    try {
      const entries = await loadDiaryEntries();
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      const todayDateString = today.toISOString().split('T')[0];

      console.log('üìÖ Ïò§Îäò ÎÇ†Ïßú:', todayDateString);
      console.log('üìö Ï†ÑÏ≤¥ ÏùºÍ∏∞ Í∞úÏàò:', entries.length);

      // Ïò§Îäò ÎÇ†ÏßúÏóê Ìï¥ÎãπÌïòÎäî ÏùºÍ∏∞Îì§ Ï∞æÍ∏∞ (ÎÇ†ÏßúÍ∞Ä Ïò§ÎäòÏù∏ Î™®Îì† ÏùºÍ∏∞)
      const todayPastEntries = entries.filter(entry => {
        const entryDate = new Date(entry.date);
        entryDate.setHours(0, 0, 0, 0);

        // ÏùºÍ∏∞Ïùò ÎÇ†ÏßúÍ∞Ä Ïò§ÎäòÏù∏ÏßÄ ÌôïÏù∏ (ÌÉÄÏûÑÎùºÏù∏ Î°úÏßÅÍ≥º ÎèôÏùº)
        const diffTime = entryDate.getTime() - today.getTime();
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        const isToday = diffDays === 0;

        console.log(`üìù ÏùºÍ∏∞: ${entry.title}`);
        console.log(`  - ÏùºÍ∏∞ ÎÇ†Ïßú: ${entry.date}`);
        console.log(`  - ÏùºÍ∏∞ ÎÇ†Ïßú Í∞ùÏ≤¥: ${entryDate.toDateString()}`);
        console.log(`  - Ïò§Îäò ÎÇ†Ïßú: ${todayDateString}`);
        console.log(`  - Ïò§Îäò ÎÇ†Ïßú Í∞ùÏ≤¥: ${today.toDateString()}`);
        console.log(`  - ÎÇ†Ïßú Ï∞®Ïù¥ (Ïùº): ${diffDays}`);
        console.log(`  - Ïò§ÎäòÏù∏Í∞Ä?: ${isToday}`);
        console.log('  ---');

        return isToday;
      });

      console.log('‚òÄÔ∏è Ïò§Îäò ÏùºÏñ¥ÎÇ† Ïùº Í∞úÏàò:', todayPastEntries.length);
      console.log(
        '‚òÄÔ∏è Ïò§Îäò ÏùºÏñ¥ÎÇ† Ïùº Î™©Î°ù:',
        todayPastEntries.map(e => e.title),
      );

      setTodayEntries(todayPastEntries);

      const items: TimelineItem[] = entries
        .map(entry => {
          const entryDate = new Date(entry.date);
          entryDate.setHours(0, 0, 0, 0);

          const diffTime = entryDate.getTime() - today.getTime();
          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

          let status: 'past' | 'today' | 'future';
          if (diffDays < 0) {
            status = 'past';
          } else if (diffDays === 0) {
            status = 'today';
          } else {
            status = 'future';
          }

          return {
            entry,
            status,
            daysFromNow: diffDays,
          };
        })
        .filter(item => item.status === 'future'); // ÎØ∏Îûò ÏùºÍ∏∞Îì§Îßå ÌÉÄÏûÑÎùºÏù∏Ïóê ÌëúÏãú (Ïò§Îäò ÏùºÍ∏∞Îäî ÏúÑ ÏÑπÏÖòÏóêÏÑú Ï≤òÎ¶¨)

      // ÎÇ†ÏßúÏàúÏúºÎ°ú Ï†ïÎ†¨ (ÌòÑÏû¨ -> ÎØ∏Îûò)
      items.sort((a, b) => a.daysFromNow - b.daysFromNow);

      setTimelineItems(items);

      // ÏúÑÏ†Ø Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
      await WidgetService.updateWidgetData(entries, currentTheme);
    } catch (error) {
      console.error('ÌÉÄÏûÑÎùºÏù∏ Î°úÎî© Ï§ë Ïò§Î•ò:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleAddResult = (entry: DiaryEntry) => {
    setSelectedEntry(entry);
    setSelectedStatus(entry.resultStatus || null);
    setActualResultDetail(
      entry.actualResult &&
        entry.actualResult !== '‚úÖ Ïù¥Î£®Ïñ¥Ï°åÏñ¥Ïöî! üòä' &&
        entry.actualResult !== '‚ùå ÏïÑÏßÅ Ïã§ÌòÑÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî:('
        ? entry.actualResult
        : '',
    );
    setShowResultModal(true);
  };

  const handleSelectStatus = (resultStatus: 'realized' | 'not_realized') => {
    setSelectedStatus(resultStatus);
  };

  const handleSaveResult = async () => {
    if (!selectedEntry || !selectedStatus) {
      Alert.alert('ÏïåÎ¶º', 'Í≤∞Í≥ºÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
      return;
    }

    try {
      const statusText =
        selectedStatus === 'realized'
          ? '‚úÖ Ïù¥Î£®Ïñ¥Ï°åÏñ¥Ïöî! üòä'
          : '‚ùå ÏïÑÏßÅ Ïã§ÌòÑÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî:(';
      const finalResult = actualResultDetail.trim()
        ? `${statusText}\n\n${actualResultDetail.trim()}`
        : statusText;

      const updatedEntry = {
        ...selectedEntry,
        resultStatus: selectedStatus,
        actualResult: finalResult,
        updatedAt: new Date().toISOString(),
      };

      await saveDiaryEntry(updatedEntry);

      // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
      setTodayEntries(prev =>
        prev.map(entry =>
          entry.id === selectedEntry.id ? updatedEntry : entry,
        ),
      );

      setTimelineItems(prev =>
        prev.map(item =>
          item.entry.id === selectedEntry.id
            ? { ...item, entry: updatedEntry }
            : item,
        ),
      );

      setShowResultModal(false);
      setSelectedEntry(null);
      setSelectedStatus(null);
      setActualResultDetail('');

      Alert.alert(
        'ÏÑ±Í≥µ',
        selectedStatus === 'realized'
          ? 'Ïù¥Î£®Ïñ¥ÏßÑ ÏùºÎ°ú Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§! üòä'
          : 'ÏïÑÏßÅ Ïã§ÌòÑÎêòÏßÄ ÏïäÏùÄ ÏùºÎ°ú Í∏∞Î°ùÎêòÏóàÏäµÎãàÎã§.',
      );
    } catch (error) {
      Alert.alert('Ïò§Î•ò', 'Í≤∞Í≥º Ï†ÄÏû• Ï§ë Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
    }
  };

  const onRefresh = async () => {
    setRefreshing(true);
    await loadTimeline();
    setRefreshing(false);
  };

  // ÌôîÎ©¥Ïóê Ìè¨Ïª§Ïä§Îê† ÎïåÎßàÎã§ ÌÉÄÏûÑÎùºÏù∏ ÏÉàÎ°úÍ≥†Ïπ®
  useFocusEffect(
    useCallback(() => {
      loadTimeline();
    }, []),
  );

  const formatTimelineDate = (daysFromNow: number, date: string) => {
    const entryDate = new Date(date);
    const dateStr = entryDate.toLocaleDateString('ko-KR', {
      month: 'long',
      day: 'numeric',
      weekday: 'short',
    });

    if (daysFromNow === 0) {
      return `Ïò§Îäò ‚Ä¢ ${dateStr}`;
    } else if (daysFromNow === 1) {
      return `ÎÇ¥Ïùº ‚Ä¢ ${dateStr}`;
    } else if (daysFromNow === -1) {
      return `Ïñ¥Ï†ú ‚Ä¢ ${dateStr}`;
    } else if (daysFromNow > 0) {
      return `${daysFromNow}Ïùº ÌõÑ ‚Ä¢ ${dateStr}`;
    } else {
      return `${Math.abs(daysFromNow)}Ïùº Ï†Ñ ‚Ä¢ ${dateStr}`;
    }
  };

  const getStatusColor = (status: 'past' | 'today' | 'future') => {
    switch (status) {
      case 'past':
        return '#4A90E2'; // Ïó∞Ìïú ÌååÎûÄÏÉâ (PAST)
      case 'today':
        return '#2E5BBA'; // ÏßÑÌïú ÌååÎûÄÏÉâ (PRESENT)
      case 'future':
        return '#8E44AD'; // Î≥¥ÎùºÏÉâ (FUTURE)
    }
  };

  const getStatusIcon = (status: 'past' | 'today' | 'future') => {
    switch (status) {
      case 'past':
        return 'Past';
      case 'today':
        return 'Today';
      case 'future':
        return 'Future';
    }
  };

  const getMoodEmoji = (mood?: string) => {
    switch (mood) {
      case 'excited':
        return 'ü§©';
      case 'happy':
        return 'üòä';
      case 'content':
        return 'üòå';
      case 'neutral':
        return 'üòê';
      case 'sad':
        return 'üò¢';
      case 'angry':
        return 'üò†';
      case 'anxious':
        return 'üò∞';
      default:
        return 'üìù';
    }
  };

  const renderTimelineItem = ({
    item,
    index,
  }: {
    item: TimelineItem;
    index: number;
  }) => {
    const isLast = index === timelineItems.length - 1;
    const displayEmoji = item.entry.emoji || getMoodEmoji(item.entry.mood);

    return (
      <TouchableOpacity
        style={styles.timelineItemHorizontal}
        onPress={() => navigation.navigate('ViewEntry', { entry: item.entry })}
      >
        <View style={styles.timelineContentHorizontal}>
          {/* ÏúÑÏ™Ω: ÏïÑÏù¥ÏΩòÍ≥º Ïó∞Í≤∞ÏÑ† */}
          <View style={styles.timelineTopHorizontal}>
            <View
              style={[
                styles.timelineIconHorizontal,
                { backgroundColor: getStatusColor(item.status) },
              ]}
            >
              <Text style={styles.timelineIconTextHorizontal}>
                {getStatusIcon(item.status)}
              </Text>
            </View>
            {!isLast && item.status !== 'future' && (
              <View
                style={[
                  styles.timelineLineHorizontal,
                  { backgroundColor: getStatusColor(item.status) },
                ]}
              />
            )}
          </View>

          {/* ÏïÑÎûòÏ™Ω: ÎÇ†ÏßúÏôÄ Ïπ¥Îìú */}
          <View style={styles.timelineBottomHorizontal}>
            <Text
              style={[
                styles.timelineDateHorizontal,
                { color: getStatusColor(item.status) },
              ]}
            >
              {formatTimelineDate(item.daysFromNow, item.entry.date)}
            </Text>

            <View
              style={[
                styles.entryCardHorizontal,
                {
                  borderTopColor: getStatusColor(item.status),
                  backgroundColor: '#FFFFFF',
                },
              ]}
            >
              {/* 1. Ï†úÎ™© ÏÑπÏÖò: Í∏∞Î∂Ñ Ïù¥Î™®Ìã∞ÏΩò + Ï†úÎ™© */}
              <View style={styles.titleMoodSectionHorizontal}>
                <Text style={styles.todayEntryEmojiHorizontal}>
                  {displayEmoji}
                </Text>
                <Text
                  style={[styles.todayEntryTitleHorizontal, { flex: 1 }]}
                  numberOfLines={1}
                >
                  {item.entry.title}
                </Text>
              </View>

              {/* 2. ÏùºÍ∏∞ ÎÇ¥Ïö© */}
              <Text
                style={styles.todayEntryContentHorizontal}
                numberOfLines={2}
              >
                {item.entry.content}
              </Text>

              {/* 3. Ïù¥ÎØ∏ÏßÄ (ÏûàÏùÑ Í≤ΩÏö∞) */}
              {item.entry.images && item.entry.images.length > 0 && (
                <View style={styles.imageContainerHorizontal}>
                  <Image
                    source={{ uri: item.entry.images[0] }}
                    style={styles.entryImageHorizontal}
                    resizeMode="cover"
                    onError={error => {
                      console.log(
                        'üö® ÌÉÄÏûÑÎùºÏù∏ Ïù¥ÎØ∏ÏßÄ Î°úÎî© Ïò§Î•ò:',
                        error.nativeEvent.error,
                      );
                      console.log('üö® Î¨∏Ï†ú Ïù¥ÎØ∏ÏßÄ URI:', item.entry.images![0]);
                    }}
                    onLoad={() => {
                      console.log(
                        '‚úÖ ÌÉÄÏûÑÎùºÏù∏ Ïù¥ÎØ∏ÏßÄ Î°úÎî© ÏÑ±Í≥µ:',
                        item.entry.images![0],
                      );
                    }}
                  />
                  {item.entry.images.length > 1 && (
                    <Text style={styles.imageCountHorizontal}>
                      +{item.entry.images.length - 1}
                    </Text>
                  )}
                </View>
              )}

              {/* 4. ÌÉúÍ∑∏ */}
              <View style={styles.tagsContainerHorizontal}>
                {/* ÎÇ†Ïî® ÌÉúÍ∑∏ */}
                {item.entry.selectedWeather &&
                  item.entry.selectedWeather.length > 0 && (
                    <>
                      {item.entry.selectedWeather
                        .slice(0, 1)
                        .map((weather, index) => {
                          const weatherOption = (
                            categoryOptionsMap.weather?.options as any
                          )?.[weather];
                          if (weatherOption) {
                            return (
                              <View
                                key={index}
                                style={[
                                  styles.categoryTagHorizontal,
                                  {
                                    backgroundColor: weatherOption.color,
                                  },
                                ]}
                              >
                                <Text style={styles.categoryTagIconHorizontal}>
                                  {weatherOption.icon}
                                </Text>
                                <Text style={styles.categoryTagTextHorizontal}>
                                  {weatherOption.name}
                                </Text>
                              </View>
                            );
                          }
                          return null;
                        })}
                      {item.entry.selectedWeather.length > 1 && (
                        <Text style={styles.moreCategoriesTextHorizontal}>
                          +{item.entry.selectedWeather.length - 1}
                        </Text>
                      )}
                    </>
                  )}

                {/* Í∏∞ÌÉÄ ÌÉúÍ∑∏ */}
                {item.entry.tags && item.entry.tags.length > 0 && (
                  <>
                    {item.entry.tags.slice(0, 1).map((tag, index) => {
                      const tagInfo =
                        typeof tag === 'string'
                          ? { name: tag, icon: '', color: '#e9ecef' }
                          : tag;
                      return (
                        <View
                          key={index}
                          style={[
                            styles.tagHorizontal,
                            {
                              backgroundColor: tagInfo.color + '20',
                            },
                          ]}
                        >
                          {tagInfo.icon && (
                            <Text style={styles.tagIconHorizontal}>
                              {tagInfo.icon}
                            </Text>
                          )}
                          <Text
                            style={styles.tagTextHorizontal}
                            numberOfLines={1}
                          >
                            #{tagInfo.name}
                          </Text>
                        </View>
                      );
                    })}
                    {item.entry.tags.length > 1 && (
                      <Text style={styles.moreTagsTextHorizontal}>
                        +{item.entry.tags.length - 1}
                      </Text>
                    )}
                  </>
                )}
              </View>
            </View>
          </View>
        </View>
      </TouchableOpacity>
    );
  };

  const renderTodayEntry = ({ item }: { item: DiaryEntry }) => {
    const displayEmoji = item.emoji || getMoodEmoji(item.mood);
    const hasResult =
      item.resultStatus ||
      (item.actualResult && item.actualResult.trim().length > 0);

    // ÎîîÎ≤ÑÍπÖÏùÑ ÏúÑÌïú Î°úÍ∑∏ Ï∂îÍ∞Ä
    console.log('üì± TimelineScreen renderTodayEntry:', item.title);
    console.log('üñºÔ∏è Images:', item.images);
    console.log('üìä Images length:', item.images?.length);

    return (
      <TouchableOpacity
        style={styles.todayEntryCard}
        onPress={() => {
          console.log('üî• iOS Ïò§Îäò ÏùºÍ∏∞ Ïπ¥Îìú ÌÅ¥Î¶≠Îê®:', item.title);
          navigation.navigate('ViewEntry', { entry: item });
        }}
        activeOpacity={0.8}
        // iOS Ï†ÑÏö© ÌÑ∞Ïπò ÏÑ§Ï†ï
        delayPressIn={0}
        delayPressOut={0}
        delayLongPress={500}
        hitSlop={{ top: 10, bottom: 10, left: 10, right: 10 }}
      >
        {/* 1. Ï†úÎ™© ÏÑπÏÖò: Í∏∞Î∂Ñ Ïù¥Î™®Ìã∞ÏΩò + Ï†úÎ™© */}
        <View style={styles.titleMoodSection}>
          <Text style={styles.todayEntryEmoji}>{displayEmoji}</Text>
          <Text
            style={[styles.todayEntryTitle, { marginLeft: 8, flex: 1 }]}
            numberOfLines={1}
          >
            {item.title}
          </Text>
        </View>

        {/* 2. Î©îÏù∏ ÏΩòÌÖêÏ∏† ÏÑπÏÖò: ÏùºÍ∏∞ÎÇ¥Ïö© + Ïù¥ÎØ∏ÏßÄ (Ï¢åÏö∞ Î∂ÑÌï†) */}
        <View style={styles.contentImageSection}>
          {/* Ï¢åÏ∏°: ÏùºÍ∏∞ ÎÇ¥Ïö© + ÎÇ†Ïî® ÌÉúÍ∑∏ */}
          <View style={styles.leftContentSection}>
            <Text style={styles.todayEntryPreviewContent} numberOfLines={2}>
              {item.content}
            </Text>

            {/* ÎÇ†Ïî® ÌÉúÍ∑∏ÏôÄ Í∏∞ÌÉÄ ÌÉúÍ∑∏Î•º Ìïú Ï§ÑÎ°ú ÌÜµÌï© */}
            <View style={styles.allTagsSection}>
              {/* ÎÇ†Ïî® ÌÉúÍ∑∏ */}
              {item.selectedWeather && item.selectedWeather.length > 0 && (
                <>
                  {item.selectedWeather.slice(0, 1).map((weather, index) => {
                    const weatherOption = (
                      categoryOptionsMap.weather?.options as any
                    )?.[weather];
                    if (weatherOption) {
                      return (
                        <View
                          key={index}
                          style={[
                            styles.categoryTag,
                            {
                              backgroundColor: weatherOption.color,
                              marginRight: 6,
                            },
                          ]}
                        >
                          <Text style={styles.categoryTagIcon}>
                            {weatherOption.icon}
                          </Text>
                          <Text style={styles.categoryTagText}>
                            {weatherOption.name}
                          </Text>
                        </View>
                      );
                    }
                    return null;
                  })}
                  {item.selectedWeather.length > 1 && (
                    <Text
                      style={[styles.moreCategoriesText, { marginRight: 6 }]}
                    >
                      +{item.selectedWeather.length - 1}
                    </Text>
                  )}
                </>
              )}

              {/* Í∏∞ÌÉÄ ÌÉúÍ∑∏ */}
              {item.tags && item.tags.length > 0 && (
                <>
                  {item.tags.slice(0, 2).map((tag, index) => {
                    const tagInfo =
                      typeof tag === 'string'
                        ? { name: tag, icon: '', color: '#e9ecef' }
                        : tag;
                    return (
                      <View
                        key={index}
                        style={[
                          styles.tag,
                          {
                            backgroundColor: tagInfo.color + '20',
                            marginRight: 6,
                          },
                        ]}
                      >
                        {tagInfo.icon && (
                          <Text style={styles.tagIcon}>{tagInfo.icon}</Text>
                        )}
                        <Text style={styles.tagText} numberOfLines={1}>
                          #{tagInfo.name}
                        </Text>
                      </View>
                    );
                  })}
                  {item.tags.length > 2 && (
                    <Text style={styles.moreTagsText}>
                      +{item.tags.length - 2}
                    </Text>
                  )}
                </>
              )}
            </View>
          </View>

          {/* Ïö∞Ï∏°: Ïù¥ÎØ∏ÏßÄ (ÌÅ¨Í∏∞ Ï§ÑÏûÑ) */}
          {item.images && item.images.length > 0 && (
            <View style={styles.todayEntrySmallImageSection}>
              <View style={styles.todayEntrySmallImageContainer}>
                <Image
                  source={{ uri: item.images![0] }}
                  style={styles.todayEntrySmallImage}
                  resizeMode="cover"
                  onError={error => {
                    console.log(
                      'üö® TimelineScreen Ïù¥ÎØ∏ÏßÄ Î°úÎî© Ïò§Î•ò:',
                      error.nativeEvent.error,
                    );
                    console.log('üö® Î¨∏Ï†ú Ïù¥ÎØ∏ÏßÄ URI:', item.images![0]);
                  }}
                  onLoad={() => {
                    console.log(
                      '‚úÖ TimelineScreen Ïù¥ÎØ∏ÏßÄ Î°úÎî© ÏÑ±Í≥µ:',
                      item.images![0],
                    );
                  }}
                />
              </View>
              {item.images.length > 1 && (
                <Text style={styles.smallImageCountText}>
                  +{item.images.length - 1}
                </Text>
              )}
            </View>
          )}
        </View>

        {/* 4. Í≤∞Í≥º ÌëúÏãú (ÏûàÏùÑ Í≤ΩÏö∞) */}
        {hasResult && (
          <View style={styles.resultSection}>
            <Text style={styles.resultLabel}>Ïã§Ï†ú Í≤∞Í≥º:</Text>
            <View
              style={[
                styles.resultStatusContainer,
                item.resultStatus === 'realized'
                  ? styles.realizedResult
                  : styles.notRealizedResult,
              ]}
            >
              <Text
                style={[
                  styles.resultStatusText,
                  item.resultStatus === 'realized'
                    ? styles.realizedText
                    : styles.notRealizedText,
                ]}
              >
                {item.resultStatus === 'realized'
                  ? '‚úÖ Ïù¥Î£®Ïñ¥Ï°åÏñ¥Ïöî! üòä'
                  : '‚ùå ÏïÑÏßÅ Ïã§ÌòÑÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî:('}
              </Text>
              {item.actualResult &&
                item.actualResult !== '‚úÖ Ïù¥Î£®Ïñ¥Ï°åÏñ¥Ïöî! üòä' &&
                item.actualResult !== '‚ùå ÏïÑÏßÅ Ïã§ÌòÑÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî:(' && (
                  <Text style={styles.resultDetailText}>
                    {item.actualResult.replace(
                      /^(‚úÖ Ïù¥Î£®Ïñ¥Ï°åÏñ¥Ïöî! üòä|‚ùå ÏïÑÏßÅ Ïã§ÌòÑÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî:\()\n\n/,
                      '',
                    )}
                  </Text>
                )}
            </View>
          </View>
        )}

        {/* 5. Î≤ÑÌäº ÏÑπÏÖò (Ï†ÑÏ≤¥ ÎÑàÎπÑ) */}
        <View style={styles.buttonSection}>
          {hasResult ? (
            <TouchableOpacity
              style={styles.editResultButton}
              onPress={() => handleAddResult(item)}
            >
              <Text style={styles.editResultButtonText}>Í≤∞Í≥º Î≥ÄÍ≤Ω</Text>
            </TouchableOpacity>
          ) : (
            <TouchableOpacity
              style={styles.addResultButton}
              onPress={() => handleAddResult(item)}
            >
              <Text style={styles.addResultButtonText}>
                ü§î Ïñ¥ÎñªÍ≤å ÎêòÏóàÎÇòÏöî?
              </Text>
            </TouchableOpacity>
          )}
        </View>
      </TouchableOpacity>
    );
  };

  if (loading) {
    return (
      <View style={styles.centerContainer}>
        <Text style={styles.loadingText}>ÌÉÄÏûÑÎùºÏù∏ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</Text>
      </View>
    );
  }

  return (
    <ThemeBackground>
      <View
        style={[
          styles.container,
          {
            backgroundColor: currentTheme.colors.background,
          },
        ]}
      >
        {/* Safe Area Spacer */}
        <View style={{ height: safeAreaInsets.top }} />

        {/* Ìó§Îçî ÏÑπÏÖò - 15% */}
        <View
          style={[
            styles.header,
            {
              backgroundColor: currentTheme.colors.surface,
              borderBottomColor: currentTheme.colors.border,
              flex: 0.15,
            },
          ]}
        >
          <View
            style={{
              flexDirection: 'row',
              alignItems: 'center',
              justifyContent: 'space-between',
              flex: 1,
            }}
          >
            <View
              style={{ flexDirection: 'row', alignItems: 'center', flex: 1 }}
            >
              <Icon name="star" size={22} color="#8B5CF6" />
              <View style={{ marginLeft: 8, flex: 1 }}>
                <Text
                  style={[
                    styles.headerTitle,
                    { color: currentTheme.colors.text },
                  ]}
                >
                  ÎØ∏ÎûòÏùºÍ∏∞ ÌÉÄÏûÑÎùºÏù∏
                </Text>
                <Text
                  style={[
                    styles.headerSubtitle,
                    { color: currentTheme.colors.textSecondary },
                  ]}
                >
                  Ïò§ÎäòÎ∂ÄÌÑ∞ ÏãúÏûëÎêòÎäî ÎÇòÏùò ÎØ∏Îûò Ïó¨Ìñâ
                </Text>
              </View>
            </View>

            {/* Ï≤úÏÇ¨ ÌÖåÎßàÏùº ÎïåÎßå angel01.png Ïù¥ÎØ∏ÏßÄ ÌëúÏãú */}
            {currentTheme.id === 'angel' && (
              <Image
                source={require('../images/angel01.png')}
                style={styles.angelImage}
                resizeMode="contain"
              />
            )}

            {/* ÏùÄÌïòÏàò ÌÖåÎßàÏùº ÎïåÎßå enhasu.png Ïù¥ÎØ∏ÏßÄ ÌëúÏãú */}
            {currentTheme.id === 'galaxy-dream' && (
              <Image
                source={require('../images/enhasu.png')}
                style={styles.enhasuImage}
                resizeMode="contain"
                onError={error => console.log('enhasu.png Î°úÎìú Ïã§Ìå®:', error)}
              />
            )}

            {/* Î°úÏ¶àÍ≥®Îìú ÌÖåÎßàÏùº ÎïåÎßå romance.png Ïù¥ÎØ∏ÏßÄ ÌëúÏãú */}
            {currentTheme.id === 'rosegold-love' && (
              <Image
                source={require('../images/romance.png')}
                style={styles.romanceImage}
                resizeMode="contain"
                onError={error => console.log('romance.png Î°úÎìú Ïã§Ìå®:', error)}
              />
            )}

            {/* Îã¨Îπõ ÏÑ∏Î†àÎÇòÎç∞ ÌÖåÎßàÏùº ÎïåÎßå moonra.png Ïù¥ÎØ∏ÏßÄ ÌëúÏãú */}
            {currentTheme.id === 'moonlight-serenade' && (
              <Image
                source={require('../images/moonra.png')}
                style={styles.moonraImage}
                resizeMode="contain"
                onError={error => console.log('moonra.png Î°úÎìú Ïã§Ìå®:', error)}
              />
            )}
          </View>
        </View>

        {/* Ïò§Îäò ÏùºÏñ¥ÎÇ† Ïùº ÏÑπÏÖò - 42.5% */}
        <View
          style={[
            styles.todaySection,
            {
              backgroundColor: currentTheme.colors.surface,
              flex: 0.425,
            },
          ]}
        >
          {todayEntries.length > 0 ? (
            <>
              <View style={styles.todaySectionTitleContainer}>
                <Text
                  style={[
                    styles.todaySectionTitle,
                    { color: currentTheme.colors.text },
                  ]}
                >
                  ‚òÄÔ∏è Ïò§Îäò ÏùºÏñ¥ÎÇ† Ïùº!
                </Text>
                <Text
                  style={[
                    styles.todayBadge,
                    {
                      backgroundColor: currentTheme.colors.primary,
                      color: currentTheme.colors.background,
                    },
                  ]}
                >
                  Today
                </Text>
              </View>
              <Text
                style={[
                  styles.todaySectionSubtitle,
                  { color: currentTheme.colors.textSecondary },
                ]}
              >
                Í≥ºÍ±∞Ïóê ÏûëÏÑ±ÌñàÎçò Ïò§ÎäòÏùò ÏòàÏÉÅ ÏùºÏ†ïÎì§ÏûÖÎãàÎã§
              </Text>
              <FlatList
                data={todayEntries}
                renderItem={renderTodayEntry}
                keyExtractor={item => item.id}
                horizontal={true}
                showsHorizontalScrollIndicator={false}
                contentContainerStyle={styles.todayEntriesContainer}
                ItemSeparatorComponent={() => (
                  <View style={styles.todayEntrySeparator} />
                )}
                // iOS Í∏∞Î≥∏ ÏÑ§Ï†ï (ÎØ∏Îûò ÏùºÍ∏∞ÏôÄ ÎèôÏùº)
                bounces={true}
                alwaysBounceHorizontal={true}
                scrollEnabled={true}
                // iOSÏôÄ ÎèôÏùºÌïú snap back Ìö®Í≥º
                snapToStart={true}
                snapToAlignment="start"
                snapToInterval={Platform.OS === 'android' ? 316 : undefined}
                // iOS Ï†ÑÏö© ÌÑ∞Ïπò Í∞ÑÏÑ≠ Î∞©ÏßÄ ÏÑ§Ï†ï
                scrollEventThrottle={16}
                canCancelContentTouches={false}
                delaysContentTouches={false}
                // AndroidÏóêÏÑú iOSÏôÄ ÎèôÏùºÌïú Í≤ΩÌóò Ï†úÍ≥µ
                {...(Platform.OS === 'android' && {
                  overScrollMode: 'always',
                  nestedScrollEnabled: true,
                  removeClippedSubviews: false,
                  decelerationRate: 0.9, // Îçî Î∂ÄÎìúÎü¨Ïö¥ Í∞êÏÜç
                  bouncesZoom: false,
                })}
                // iOSÏôÄ ÎèôÏùºÌïú Ïä§ÌÅ¨Î°§ ÌäπÏÑ±
                automaticallyAdjustContentInsets={false}
              />
            </>
          ) : (
            <View style={styles.emptyTodayContainer}>
              <Text
                style={[
                  styles.emptyTodayText,
                  { color: currentTheme.colors.textSecondary },
                ]}
              >
                Ïò§Îäò ÏùºÏñ¥ÎÇ† ÏòàÏ†ïÏù∏ ÏùºÍ∏∞Í∞Ä ÏóÜÏäµÎãàÎã§
              </Text>
            </View>
          )}
        </View>

        {/* ÎØ∏Îûò ÏùºÍ∏∞ ÌÉÄÏûÑÎùºÏù∏ ÏÑπÏÖò - 42.5% */}
        <View style={[styles.timelineSection, { flex: 0.425 }]}>
          {timelineItems.length === 0 ? (
            <View style={styles.emptyContainer}>
              <Text
                style={[styles.emptyText, { color: currentTheme.colors.text }]}
              >
                ÏïÑÏßÅ ÏûëÏÑ±Îêú ÏùºÍ∏∞Í∞Ä ÏóÜÏäµÎãàÎã§.
              </Text>
              <Text
                style={[
                  styles.emptySubText,
                  { color: currentTheme.colors.textSecondary },
                ]}
              >
                ÎØ∏ÎûòÏùò ÎÇòÏóêÍ≤å Î≥¥ÎÇº Ï≤´ Î≤àÏß∏ ÏùºÍ∏∞Î•º ÏûëÏÑ±Ìï¥Î≥¥ÏÑ∏Ïöî!
              </Text>
              <TouchableOpacity
                style={[
                  styles.emptyButton,
                  { backgroundColor: currentTheme.colors.primary },
                ]}
                onPress={() => navigation.navigate('WriteEntry', {})}
              >
                <Text
                  style={[
                    styles.emptyButtonText,
                    { color: currentTheme.colors.background },
                  ]}
                >
                  ÎØ∏ÎûòÏùºÍ∏∞ Ïì∞Í∏∞
                </Text>
              </TouchableOpacity>
            </View>
          ) : (
            <FlatList
              data={timelineItems}
              renderItem={renderTimelineItem}
              keyExtractor={item => item.entry.id}
              refreshControl={
                <RefreshControl refreshing={refreshing} onRefresh={onRefresh} />
              }
              contentContainerStyle={styles.listContainer}
              showsHorizontalScrollIndicator={false}
              horizontal={true}
            />
          )}
        </View>

        {/* Ïã§Ï†ú Í≤∞Í≥º ÏÑ†ÌÉù Î™®Îã¨ */}
        <Modal
          visible={showResultModal}
          animationType="slide"
          transparent={true}
          onRequestClose={() => setShowResultModal(false)}
        >
          <TouchableWithoutFeedback onPress={() => Keyboard.dismiss()}>
            <View style={styles.modalContainer}>
              <View
                style={[
                  styles.modalContent,
                  { backgroundColor: currentTheme.colors.surface },
                ]}
              >
                <Text
                  style={[
                    styles.modalTitle,
                    { color: currentTheme.colors.text },
                  ]}
                >
                  Ïã§Ï†ú Í≤∞Í≥º Í∏∞Î°ù
                </Text>
                <Text
                  style={[
                    styles.modalSubtitle,
                    { color: currentTheme.colors.textSecondary },
                  ]}
                >
                  "{selectedEntry?.title}"Ïóê ÎåÄÌïú Í≤∞Í≥ºÎ•º Í∏∞Î°ùÌï¥Ï£ºÏÑ∏Ïöî
                </Text>

                <View style={styles.resultOptionContainer}>
                  <TouchableOpacity
                    style={[
                      styles.resultOption,
                      styles.realizedOption,
                      selectedStatus === 'realized' && styles.selectedOption,
                    ]}
                    onPress={() => handleSelectStatus('realized')}
                  >
                    <Text style={styles.resultOptionEmoji}>‚úÖ</Text>
                    <Text
                      style={[
                        styles.resultOptionText,
                        { color: currentTheme.colors.text },
                      ]}
                    >
                      Ïù¥Î£®Ïñ¥Ï°åÏñ¥Ïöî! üòä
                    </Text>
                    <Text
                      style={[
                        styles.resultOptionDescription,
                        { color: currentTheme.colors.textSecondary },
                      ]}
                    >
                      ÏòàÏÉÅÌñàÎçò ÏùºÏù¥ Ïã§Ï†úÎ°ú ÏùºÏñ¥ÎÇ¨Ïñ¥Ïöî
                    </Text>
                  </TouchableOpacity>

                  <TouchableOpacity
                    style={[
                      styles.resultOption,
                      styles.notRealizedOption,
                      selectedStatus === 'not_realized' &&
                        styles.selectedOption,
                    ]}
                    onPress={() => handleSelectStatus('not_realized')}
                  >
                    <Text style={styles.resultOptionEmoji}>‚ùå</Text>
                    <Text
                      style={[
                        styles.resultOptionText,
                        { color: currentTheme.colors.text },
                      ]}
                    >
                      ÏïÑÏßÅ Ïã§ÌòÑÎêòÏßÄ ÏïäÏïòÏñ¥Ïöî:(
                    </Text>
                    <Text
                      style={[
                        styles.resultOptionDescription,
                        { color: currentTheme.colors.textSecondary },
                      ]}
                    >
                      ÏòàÏÉÅÍ≥º Îã§Î•¥Í≤å ÏùºÏñ¥ÎÇòÏßÄ ÏïäÏïòÏñ¥Ïöî
                    </Text>
                  </TouchableOpacity>
                </View>

                <View style={styles.detailInputContainer}>
                  <Text
                    style={[
                      styles.detailInputLabel,
                      { color: currentTheme.colors.text },
                    ]}
                  >
                    Ïã§Ï†úÎ°ú ÏùºÏñ¥ÎÇú ÏùºÏùÑ Í∏∞Î°ùÌï¥Ï£ºÏÑ∏Ïöî
                  </Text>
                  <TextInput
                    style={[
                      styles.detailInput,
                      {
                        backgroundColor: currentTheme.colors.background,
                        borderColor: currentTheme.colors.border,
                        color: currentTheme.colors.text,
                      },
                    ]}
                    value={actualResultDetail}
                    onChangeText={setActualResultDetail}
                    placeholder="ÏûêÏÑ∏Ìïú ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî... (ÏÑ†ÌÉùÏÇ¨Ìï≠)"
                    placeholderTextColor={currentTheme.colors.textSecondary}
                    multiline
                    textAlignVertical="top"
                    maxLength={500}
                    returnKeyType="done"
                    blurOnSubmit={true}
                    onSubmitEditing={() => {
                      Keyboard.dismiss();
                    }}
                  />
                </View>

                <View style={styles.modalButtonContainer}>
                  <TouchableOpacity
                    style={[
                      styles.cancelButton,
                      { backgroundColor: currentTheme.colors.textSecondary },
                    ]}
                    onPress={() => setShowResultModal(false)}
                  >
                    <Text style={styles.cancelButtonText}>Ï∑®ÏÜå</Text>
                  </TouchableOpacity>
                  <TouchableOpacity
                    style={[
                      styles.saveButton,
                      { backgroundColor: currentTheme.colors.success },
                      !selectedStatus && styles.disabledButton,
                    ]}
                    onPress={handleSaveResult}
                    disabled={!selectedStatus}
                  >
                    <Text
                      style={[
                        styles.saveButtonText,
                        !selectedStatus && styles.disabledButtonText,
                      ]}
                    >
                      Ï†ÄÏû•
                    </Text>
                  </TouchableOpacity>
                </View>
              </View>
            </View>
          </TouchableWithoutFeedback>
        </Modal>
      </View>
    </ThemeBackground>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
  },
  centerContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
  },
  header: {
    flex: 0.15,
    paddingHorizontal: 20,
    paddingVertical: 20,
    borderBottomWidth: 1,
    justifyContent: 'center',
  },
  headerTitle: {
    fontSize: 24,
    fontWeight: 'bold',
    marginBottom: 4,
  },
  headerSubtitle: {
    fontSize: 14,
    color: '#6c757d',
  },
  loadingText: {
    fontSize: 16,
    color: '#6c757d',
  },
  emptyContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    paddingHorizontal: 40,
  },
  emptyText: {
    fontSize: 18,
    color: '#495057',
    textAlign: 'center',
    marginBottom: 8,
  },
  emptySubText: {
    fontSize: 14,
    color: '#6c757d',
    textAlign: 'center',
    marginBottom: 32,
  },
  emptyButton: {
    backgroundColor: '#007bff',
    paddingHorizontal: 32,
    paddingVertical: 12,
    borderRadius: 25,
  },
  emptyButtonText: {
    color: '#ffffff',
    fontSize: 16,
    fontWeight: '600',
  },
  listContainer: {
    paddingHorizontal: 20,
    paddingVertical: 20,
  },
  timelineItem: {
    marginBottom: 20,
  },
  timelineContent: {
    flexDirection: 'row',
  },
  timelineLeft: {
    alignItems: 'center',
    marginRight: 16,
  },
  timelineIcon: {
    minWidth: 60,
    height: 32,
    borderRadius: 16,
    justifyContent: 'center',
    alignItems: 'center',
    zIndex: 1,
    paddingHorizontal: 8,
  },
  timelineIconText: {
    color: '#ffffff',
    fontSize: 10,
    fontWeight: 'bold',
  },
  timelineLine: {
    width: 2,
    flex: 1,
    marginTop: 8,
    opacity: 0.3,
  },
  timelineRight: {
    flex: 1,
  },
  timelineDate: {
    fontSize: 14,
    fontWeight: '600',
    marginBottom: 8,
  },
  entryCard: {
    backgroundColor: '#ffffff',
    borderRadius: 12,
    padding: 16,
    shadowColor: '#000',
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.1,
    shadowRadius: 3,
    elevation: 3,
    borderLeftWidth: 4,
  },
  entryCardContent: {
    flexDirection: 'row',
  },
  entryLeftContent: {
    flex: 1,
  },
  entryRightContent: {
    flexDirection: 'column',
    alignItems: 'center',
    marginLeft: 12,
  },
  entryImageContainer: {
    width: 80,
    height: 80,
    borderRadius: 12,
    overflow: 'hidden',
    backgroundColor: '#f8f9fa',
    borderWidth: 1,
    borderColor: '#e9ecef',
  },
  entryImage: {
    width: '100%',
    height: '100%',
  },
  timelineImageCountBadge: {
    backgroundColor: '#343a40',
    borderRadius: 10,
    paddingHorizontal: 6,
    paddingVertical: 2,
    marginTop: 4,
  },
  timelineImageCountText: {
    fontSize: 10,
    fontWeight: 'bold',
    color: '#fff',
  },
  entryHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
  },
  entryMood: {
    fontSize: 20,
    marginRight: 8,
  },
  entryTitle: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#343a40',
    flex: 1,
  },
  entryContent: {
    fontSize: 14,
    color: '#495057',
    lineHeight: 20,
    marginBottom: 12,
  },
  tagsContainer: {
    flexDirection: 'row',
    flexWrap: 'nowrap',
    alignItems: 'center',
    overflow: 'hidden',
  },
  tag: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#e9ecef',
    borderRadius: 16,
    paddingHorizontal: 8,
    paddingVertical: 4,
    marginRight: 6,
    flexShrink: 0,
  },
  tagText: {
    fontSize: 12,
    color: '#495057',
  },
  moreTagsText: {
    fontSize: 12,
    color: '#6c757d',
    fontStyle: 'italic',
  },
  tagIcon: {
    fontSize: 12,
    marginRight: 4,
  },
  todaySection: {
    flex: 0.425,
    paddingTop: 20,
    paddingBottom: 20,
    paddingHorizontal: 0,
    backgroundColor: '#fff8e1',
    borderBottomWidth: 1,
    borderBottomColor: '#e9ecef',
  },
  timelineSection: {
    flex: 0.425,
  },
  todaySectionTitleContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
    paddingHorizontal: 20,
  },
  todaySectionTitle: {
    fontSize: 22,
    fontWeight: 'bold',
    color: '#f57c00',
    marginRight: 8,
  },
  todayBadge: {
    fontSize: 14,
    fontWeight: 'bold',
    color: '#ffffff',
    backgroundColor: '#2E5BBA',
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 12,
    transform: [{ rotate: '-10deg' }],
    shadowColor: '#000',
    shadowOffset: {
      width: 2,
      height: 2,
    },
    shadowOpacity: 0.2,
    shadowRadius: 3,
    elevation: 3,
  },
  todaySectionSubtitle: {
    fontSize: 14,
    color: '#6c757d',
    marginBottom: 20,
    paddingHorizontal: 20,
  },
  todayEntriesContainer: {
    paddingHorizontal: 20,
    paddingVertical: 10,
    // iOSÏôÄ ÏôÑÏ†ÑÌûà ÎèôÏùºÌïú Î†àÏù¥ÏïÑÏõÉ Ï†úÍ≥µ
    ...Platform.select({
      ios: {
        paddingRight: 50, // iOS Í∏∞Î≥∏ Ïó¨Î∞±
      },
      android: {
        paddingRight: 50, // iOSÏôÄ ÎèôÏùºÌïú Ïó¨Î∞±ÏúºÎ°ú Î≥ÄÍ≤Ω
        // snap backÏùÑ ÏúÑÌïú Ï†ïÌôïÌïú ÌÅ¨Í∏∞ ÏÑ§Ï†ï
        flexGrow: 0,
        alignItems: 'flex-start',
      },
    }),
  },
  todayEntrySeparator: {
    width: 16,
  },
  todayEntryCard: {
    backgroundColor: '#ffffff',
    borderRadius: 12,
    padding: 14,
    width: 300, // iOSÏôÄ ÎèôÏùºÌïú Ïπ¥Îìú ÌÅ¨Í∏∞
    minHeight: 160,
    shadowColor: '#000',
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.1,
    shadowRadius: 3,
    elevation: 3,
    borderLeftWidth: 4,
    borderLeftColor: '#f57c00',
  },
  todayEntryCardContent: {
    flexDirection: 'row',
  },
  todayEntryLeftContent: {
    flex: 1,
  },
  // ÏÉàÎ°úÏö¥ Î†àÏù¥ÏïÑÏõÉ Ïä§ÌÉÄÏùºÎì§
  titleSection: {
    width: '100%',
    marginBottom: 16,
    paddingBottom: 12,
    borderBottomWidth: 1,
    borderBottomColor: '#e9ecef',
  },
  metaImageSection: {
    flexDirection: 'row',
    marginBottom: 16,
  },
  metaDataSection: {
    flex: 1,
    paddingRight: 16,
  },
  dateSection: {
    marginBottom: 8,
  },
  moodSection: {
    marginBottom: 8,
    alignItems: 'flex-start',
  },

  todayEntryImageSection: {
    width: 120,
    alignItems: 'center',
  },
  contentSection: {
    width: '100%',
    marginBottom: 16,
  },
  todayEntryFullContent: {
    fontSize: 16,
    color: '#495057',
    lineHeight: 24,
    marginBottom: 12,
  },
  resultSection: {
    width: '100%',
    marginBottom: 16,
  },
  buttonSection: {
    width: '100%',
    alignItems: 'center',
    marginTop: 4,
  },
  todayEntryHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
  },
  todayEntryEmoji: {
    fontSize: 20,
    marginRight: 12,
  },
  todayEntryInfo: {
    flex: 1,
  },
  todayEntryTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#343a40',
    textAlign: 'center',
    lineHeight: 28,
  },
  todayEntryDate: {
    fontSize: 12,
    color: '#6c757d',
  },
  todayEntryContent: {
    fontSize: 14,
    color: '#495057',
    lineHeight: 20,
    marginBottom: 12,
  },
  resultContainer: {
    backgroundColor: '#f8f9fa',
    padding: 12,
    borderRadius: 8,
    marginTop: 8,
  },
  resultLabel: {
    fontSize: 12,
    fontWeight: '600',
    color: '#495057',
    marginBottom: 4,
  },
  resultStatusContainer: {
    backgroundColor: '#f8f9fa',
    padding: 8,
    borderRadius: 8,
    marginBottom: 8,
  },
  resultStatusText: {
    fontSize: 14,
    fontWeight: '600',
    color: '#343a40',
  },
  realizedResult: {
    backgroundColor: '#d4edda',
    borderColor: '#c3e6cb',
  },
  notRealizedResult: {
    backgroundColor: '#f8d7da',
    borderColor: '#f5c6cb',
  },
  realizedText: {
    color: '#155724',
  },
  notRealizedText: {
    color: '#721c24',
  },
  resultDetailText: {
    fontSize: 12,
    color: '#6c757d',
    marginTop: 4,
  },
  editResultButton: {
    alignSelf: 'flex-start',
    backgroundColor: '#6c757d',
    paddingHorizontal: 12,
    paddingVertical: 6,
    borderRadius: 6,
  },
  editResultButtonText: {
    color: '#ffffff',
    fontSize: 12,
    fontWeight: '600',
  },
  addResultButton: {
    backgroundColor: '#28a745',
    paddingHorizontal: 16,
    paddingVertical: 8,
    borderRadius: 8,
    alignItems: 'center',
    marginTop: 4,
  },
  addResultButtonText: {
    color: '#ffffff',
    fontSize: 14,
    fontWeight: '600',
  },
  modalContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'rgba(0, 0, 0, 0.5)',
  },
  modalContent: {
    backgroundColor: '#ffffff',
    margin: 20,
    borderRadius: 16,
    padding: 24,
    width: '90%',
    maxWidth: 400,
    shadowColor: '#000',
    shadowOffset: {
      width: 0,
      height: 4,
    },
    shadowOpacity: 0.3,
    shadowRadius: 8,
    elevation: 8,
  },
  modalTitle: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#343a40',
    textAlign: 'center',
    marginBottom: 8,
  },
  modalSubtitle: {
    fontSize: 14,
    color: '#6c757d',
    textAlign: 'center',
    marginBottom: 20,
  },
  resultOptionContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: 20,
  },
  resultOption: {
    flex: 1,
    padding: 16,
    borderWidth: 2,
    borderColor: '#e9ecef',
    borderRadius: 8,
    alignItems: 'center',
  },
  resultOptionEmoji: {
    fontSize: 20,
    marginBottom: 8,
  },
  resultOptionText: {
    fontSize: 14,
    fontWeight: '600',
    color: '#343a40',
  },
  resultOptionDescription: {
    fontSize: 12,
    color: '#6c757d',
  },
  realizedOption: {
    borderColor: '#28a745',
  },
  notRealizedOption: {
    borderColor: '#dc3545',
  },
  selectedOption: {
    borderColor: '#007bff',
  },
  cancelButton: {
    flex: 1,
    backgroundColor: '#6c757d',
    paddingVertical: 12,
    borderRadius: 8,
    alignItems: 'center',
  },
  cancelButtonText: {
    color: '#ffffff',
    fontSize: 16,
    fontWeight: '600',
  },
  saveButton: {
    flex: 1,
    backgroundColor: '#28a745',
    paddingVertical: 12,
    borderRadius: 8,
    alignItems: 'center',
  },
  saveButtonText: {
    color: '#ffffff',
    fontSize: 16,
    fontWeight: '600',
  },
  disabledButton: {
    backgroundColor: '#e9ecef',
  },
  disabledButtonText: {
    color: '#6c757d',
  },
  detailInputContainer: {
    marginBottom: 20,
  },
  detailInputLabel: {
    fontSize: 14,
    fontWeight: '600',
    color: '#343a40',
    marginBottom: 8,
  },
  detailInput: {
    backgroundColor: '#ffffff',
    padding: 12,
    borderWidth: 1,
    borderColor: '#e9ecef',
    borderRadius: 8,
    textAlignVertical: 'top',
    minHeight: 80,
  },
  modalButtonContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    gap: 12,
  },
  tagContainer: {
    flexDirection: 'row',
    flexWrap: 'nowrap',
    marginTop: 8,
    marginBottom: 8,
    overflow: 'hidden',
  },
  categoriesContainer: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    marginTop: 8,
    marginBottom: 8,
  },
  categoryTag: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#e9ecef',
    borderRadius: 10,
    paddingHorizontal: 8,
    paddingVertical: 4,
    marginRight: 6,
    marginBottom: 4,
  },
  categoryTagIcon: {
    fontSize: 12,
    marginRight: 4,
  },
  categoryTagText: {
    fontSize: 12,
    color: '#495057',
  },
  moreCategoriesText: {
    fontSize: 12,
    color: '#6c757d',
    fontStyle: 'italic',
  },
  // Î°úÏ¶àÍ≥®Îìú ÌÖåÎßà Í∏∞Ï§ÄÏúºÎ°ú Î™®Îì† Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ ÌÜµÏùº
  themeImageBase: {
    width: 120,
    height: 120,
    opacity: 0.7,
    backgroundColor: 'transparent',
  },
  angelImage: {
    width: 120,
    height: 120,
    opacity: 0.7,
    backgroundColor: 'transparent',
  },
  enhasuImage: {
    width: 120,
    height: 120,
    opacity: 0.7,
    backgroundColor: 'transparent',
  },
  romanceImage: {
    width: 120,
    height: 120,
    opacity: 0.7,
    backgroundColor: 'transparent',
  },
  moonraImage: {
    width: 120,
    height: 120,
    opacity: 0.7,
    backgroundColor: 'transparent',
  },
  todayEntryRightContent: {
    flexDirection: 'column',
    alignItems: 'center',
    marginLeft: 16,
  },
  todayEntryImageContainer: {
    width: 120,
    height: 120,
    borderRadius: 16,
    overflow: 'hidden',
    backgroundColor: '#f8f9fa',
    borderWidth: 1,
    borderColor: '#e9ecef',
  },
  todayEntryImage: {
    width: '100%',
    height: '100%',
  },
  imageCountBadge: {
    backgroundColor: '#343a40',
    borderRadius: 12,
    paddingHorizontal: 8,
    paddingVertical: 4,
    marginTop: 8,
    borderWidth: 1,
    borderColor: '#fff',
  },
  imageCountText: {
    fontSize: 12,
    fontWeight: 'bold',
    color: '#fff',
  },
  emptyTodayContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    paddingVertical: 40,
  },
  emptyTodayText: {
    fontSize: 16,
    textAlign: 'center',
  },
  moodWeatherSection: {
    flexDirection: 'row',
    alignItems: 'center',
    flexWrap: 'wrap',
    marginBottom: 8,
  },
  titleMoodSection: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
  },
  contentImageSection: {
    flexDirection: 'row',
    marginBottom: 8,
  },
  leftContentSection: {
    flex: 1,
    marginRight: 12,
  },
  todayEntryPreviewContent: {
    fontSize: 14,
    color: '#495057',
    lineHeight: 18,
    marginBottom: 6,
  },
  weatherTagsSection: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
  },
  allTagsSection: {
    flexDirection: 'row',
    alignItems: 'center',
    flexWrap: 'nowrap',
    marginBottom: 6,
    overflow: 'hidden',
  },
  todayEntrySmallImageSection: {
    alignItems: 'center',
    justifyContent: 'center',
  },
  todayEntrySmallImageContainer: {
    width: 80,
    height: 80,
    borderRadius: 12,
    overflow: 'hidden',
    backgroundColor: '#f8f9fa',
    borderWidth: 1,
    borderColor: '#e9ecef',
  },
  todayEntrySmallImage: {
    width: '100%',
    height: '100%',
  },
  smallImageCountText: {
    fontSize: 10,
    fontWeight: 'bold',
    color: '#6c757d',
    marginTop: 4,
  },
  // Í∞ÄÎ°ú ÌÉÄÏûÑÎùºÏù∏ Ïä§ÌÉÄÏùºÎì§
  timelineItemHorizontal: {
    marginRight: 16,
    width: 220,
  },
  timelineContentHorizontal: {
    flexDirection: 'column',
    alignItems: 'center',
  },
  timelineTopHorizontal: {
    alignItems: 'center',
    marginBottom: 12,
    flexDirection: 'row',
  },
  timelineIconHorizontal: {
    minWidth: 60,
    height: 32,
    borderRadius: 16,
    justifyContent: 'center',
    alignItems: 'center',
    zIndex: 1,
    paddingHorizontal: 8,
  },
  timelineIconTextHorizontal: {
    color: '#ffffff',
    fontSize: 10,
    fontWeight: 'bold',
  },
  timelineLineHorizontal: {
    height: 2,
    width: 228,
    marginLeft: 8,
    opacity: 0.3,
  },
  timelineBottomHorizontal: {
    alignItems: 'center',
    width: '100%',
  },
  timelineDateHorizontal: {
    fontSize: 12,
    fontWeight: '600',
    marginBottom: 8,
    textAlign: 'center',
  },
  entryCardHorizontal: {
    backgroundColor: '#ffffff',
    borderRadius: 12,
    padding: 12,
    shadowColor: '#000',
    shadowOffset: {
      width: 0,
      height: 2,
    },
    shadowOpacity: 0.1,
    shadowRadius: 3,
    elevation: 3,
    borderTopWidth: 4,
    width: '100%',
  },
  titleMoodSectionHorizontal: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 8,
  },
  todayEntryEmojiHorizontal: {
    fontSize: 16,
    marginRight: 6,
  },
  todayEntryTitleHorizontal: {
    fontSize: 14,
    fontWeight: 'bold',
    color: '#343a40',
  },
  todayEntryContentHorizontal: {
    fontSize: 12,
    color: '#495057',
    lineHeight: 16,
    marginBottom: 8,
  },
  imageContainerHorizontal: {
    alignItems: 'center',
    marginBottom: 8,
  },
  entryImageHorizontal: {
    width: 60,
    height: 60,
    borderRadius: 8,
  },
  imageCountHorizontal: {
    fontSize: 10,
    fontWeight: 'bold',
    color: '#6c757d',
    marginTop: 4,
  },
  tagsContainerHorizontal: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    alignItems: 'center',
    justifyContent: 'center',
  },
  categoryTagHorizontal: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#e9ecef',
    borderRadius: 8,
    paddingHorizontal: 6,
    paddingVertical: 2,
    marginRight: 4,
    marginBottom: 4,
  },
  categoryTagIconHorizontal: {
    fontSize: 10,
    marginRight: 2,
  },
  categoryTagTextHorizontal: {
    fontSize: 10,
    color: '#495057',
  },
  moreCategoriesTextHorizontal: {
    fontSize: 10,
    color: '#6c757d',
    fontStyle: 'italic',
    marginRight: 4,
  },
  tagHorizontal: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#e9ecef',
    borderRadius: 8,
    paddingHorizontal: 6,
    paddingVertical: 2,
    marginRight: 4,
    marginBottom: 4,
  },
  tagIconHorizontal: {
    fontSize: 10,
    marginRight: 2,
  },
  tagTextHorizontal: {
    fontSize: 10,
    color: '#495057',
  },
  moreTagsTextHorizontal: {
    fontSize: 10,
    color: '#6c757d',
    fontStyle: 'italic',
  },
});

export default TimelineScreen;
